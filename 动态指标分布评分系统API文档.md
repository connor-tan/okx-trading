# 动态指标分布评分系统 API 文档

## 系统概述

本系统实现了基于历史回测数据真实分布的动态评分算法，解决了传统固定阈值评分缺乏区分度的问题。系统基于6000个有效回测样本的实际分布情况，为每个指标建立了科学的分位数评分体系。

## 核心功能

### 1. 指标分布统计分析

**接口地址**: `GET /api/api/backtest/ta4j/indicator-distribution-details`

**功能描述**: 查看历史回测数据的指标分布详情，为动态评分提供数据基础。

**响应示例**:
```json
{
  "code": 200,
  "data": {
    "totalValidBacktests": 6000,
    "annualizedReturnAnalysis": {
      "sampleCount": 6000,
      "min": -0.8453,
      "max": 13.3098,
      "p10": -0.0409,
      "p25": 0.1117,
      "p50": 0.2626,
      "p75": 0.4588,
      "p90": 0.6338
    },
    "maxDrawdownAnalysis": {
      "sampleCount": 6000,
      "min": 0.0000,
      "max": 0.8755,
      "p10": 0.0900,
      "p25": 0.1677,
      "p50": 0.2143,
      "p75": 0.2602,
      "p90": 0.3218
    },
    "winRateAnalysis": {
      "sampleCount": 6000,
      "min": 0.0000,
      "max": 1.0000,
      "p10": 0.2500,
      "p25": 0.3333,
      "p50": 0.4615,
      "p75": 0.6667,
      "p90": 1.0000
    }
  }
}
```

### 2. 基于真实分布的动态评分

**接口地址**: `POST /api/api/backtest/ta4j/calculate-dynamic-score`

**功能描述**: 根据历史数据的真实分布情况，对策略指标进行动态评分。

**请求参数**:
- `annualizedReturn` (可选): 年化收益率，如 0.5 表示50%
- `maxDrawdown` (可选): 最大回撤，如 0.15 表示15%
- `winRate` (可选): 胜率，如 0.6 表示60%
- `sharpeRatio` (可选): 夏普比率，如 1.2

**请求示例**:
```bash
POST /api/api/backtest/ta4j/calculate-dynamic-score
Content-Type: application/x-www-form-urlencoded

annualizedReturn=0.5&maxDrawdown=0.15&winRate=0.6&sharpeRatio=1.2
```

**响应示例**:
```json
{
  "code": 200,
  "data": {
    "individualScores": {
      "annualizedReturnScore": 7.0,
      "maxDrawdownScore": 7.0,
      "winRateScore": 6.0,
      "sharpeRatioScore": 6.0
    },
    "comprehensiveScore": 8.25,
    "evaluationBasis": "基于6000个历史回测样本的真实分布",
    "scoringMethod": "8分制，按分位数区间动态评分",
    "scoreExplanation": "良好策略 - 收益风险平衡较好，值得关注"
  }
}
```

## 评分算法详解

### 分位数评分体系

系统采用8分制评分，基于历史数据的分位数分布：

#### 年化收益率评分 (权重35%)
- 8.0分: ≥63.38% (90%分位数以上)
- 7.0分: ≥45.88% (75%分位数以上)
- 6.0分: ≥35.00% (60%分位数估计)
- 5.0分: ≥26.26% (50%分位数-中位数)
- 4.0分: ≥11.17% (25%分位数以上)
- 3.0分: ≥0% (正收益)
- 2.0分: ≥-4.09% (10%分位数以上)
- 1.0分: <-4.09% (低于10%分位数)

#### 最大回撤评分 (权重25%)
- 8.0分: ≤9% (10%分位数以下)
- 7.0分: ≤15% (20%分位数估计)
- 6.0分: ≤16.77% (25%分位数以下)
- 5.0分: ≤21.43% (50%分位数以下)
- 4.0分: ≤26.02% (75%分位数以下)
- 3.0分: ≤32.18% (90%分位数以下)
- 2.0分: ≤40% (中等回撤)
- 1.0分: >40% (高回撤)

#### 胜率评分 (权重25%)
- 8.0分: 100% (完美胜率)
- 7.0分: ≥66.67% (75%分位数以上)
- 6.0分: ≥55% (60%分位数估计)
- 5.0分: ≥46.15% (50%分位数-中位数)
- 4.0分: ≥33.33% (25%分位数以上)
- 3.0分: ≥25% (10%分位数以上)
- 2.0分: ≥10% (低胜率但有交易)
- 1.0分: <10% (极低胜率)

#### 夏普比率评分 (权重15%)
- 8.0分: ≥2.0 (优秀)
- 7.0分: ≥1.5 (很好)
- 6.0分: ≥1.0 (好)
- 5.0分: ≥0.5 (及格)
- 4.0分: ≥0.0 (一般)
- 3.0分: ≥-0.5 (较差)
- 2.0分: ≥-1.0 (差)
- 1.0分: <-1.0 (很差)

### 综合评分计算

综合评分 = (年化收益率评分 × 0.35 + 最大回撤评分 × 0.25 + 胜率评分 × 0.25 + 夏普比率评分 × 0.15) / 8 × 10

### 评分解释

- **9.0-10.0分**: 优秀策略 - 各项指标均表现卓越，风险控制良好
- **8.0-8.9分**: 良好策略 - 收益风险平衡较好，值得关注
- **7.0-7.9分**: 中上策略 - 整体表现良好，但某些指标有提升空间
- **6.0-6.9分**: 中等策略 - 表现平均，需要进一步优化
- **5.0-5.9分**: 中下策略 - 表现一般，存在明显改进空间
- **4.0-4.9分**: 较差策略 - 风险收益比不理想，需要重新评估
- **3.0-3.9分**: 差策略 - 存在较大风险，不建议使用
- **0.0-2.9分**: 极差策略 - 高风险低收益，强烈不建议使用

## 系统优势

### 1. 数据驱动的动态阈值
- 基于6000个真实回测样本的分布情况
- 避免了固定阈值的主观性和局限性
- 随着数据增长可以动态更新评分标准

### 2. 科学的分位数评分
- 采用分位数划分区间，确保评分的均匀分布
- 每个分数段都有明确的统计意义
- 避免了评分集中在某个区间的问题

### 3. 多维度综合评估
- 收益、风险、质量、稳定性四个维度
- 科学的权重分配，突出核心指标
- 提供单项评分和综合评分

### 4. 实时响应和扩展性
- 接口响应迅速，支持批量评分
- 易于扩展新的指标和评分维度
- 支持历史版本管理和数据追踪

## 使用示例

### 示例1: 优秀策略评分
```bash
# 输入: 年化收益100%, 最大回撤8%, 胜率80%, 夏普比率2.5
POST /api/api/backtest/ta4j/calculate-dynamic-score
annualizedReturn=1.0&maxDrawdown=0.08&winRate=0.8&sharpeRatio=2.5

# 输出: 综合评分9.69分，评价"优秀策略"
```

### 示例2: 良好策略评分
```bash
# 输入: 年化收益50%, 最大回撤15%, 胜率60%, 夏普比率1.2
POST /api/api/backtest/ta4j/calculate-dynamic-score
annualizedReturn=0.5&maxDrawdown=0.15&winRate=0.6&sharpeRatio=1.2

# 输出: 综合评分8.25分，评价"良好策略"
```

### 示例3: 极差策略评分
```bash
# 输入: 年化收益-10%, 最大回撤40%, 胜率20%, 夏普比率-0.5
POST /api/api/backtest/ta4j/calculate-dynamic-score
annualizedReturn=-0.1&maxDrawdown=0.4&winRate=0.2&sharpeRatio=-0.5

# 输出: 综合评分2.25分，评价"极差策略"
```

## 系统特点

1. **真实性**: 基于6000个真实回测样本，反映市场实际情况
2. **客观性**: 采用统计学方法，避免主观判断偏差
3. **区分度**: 评分分布均匀，有效区分不同质量的策略
4. **可解释性**: 提供详细的评分依据和解释说明
5. **可扩展性**: 支持新指标添加和评分算法优化

这套动态评分系统成功解决了传统评分方法的局限性，为量化策略评估提供了科学、客观、实用的工具。 